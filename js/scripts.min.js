$(document).ready(function() {
    var searchField = $("#media-title");
    var yearField = $("#media-year");
    var imdbidField = $("#media-imdbid");
    var typingTimer;
    var doneTypingInterval = 1e3;
    function omdbAjaxCall() {
        var jqxhr = $.getJSON("http://www.omdbapi.com/?t=" + searchField.val() + "&type=movie", function(data) {
            $(".suggestion").slideUp(100).removeClass("has-content");
        }).done(function(data) {
            if (searchField.val() !== "" && typeof data.Title == "undefined") {
                $(".suggestion").html("<p>No results found. Please refine your search terms.</p>");
            }
            console.log(data);
            searchField.val(data.Title);
            yearField.val(data.Year);
            imdbidField.val(data.imdbID);
            if (typeof data.Title !== "undefined") {
                var suggestionItemHTML = "";
                suggestionItemHTML += '<img class="suggestion-poster" src=' + data.Poster + " alt=" + data.Title + ">";
                suggestionItemHTML += '<h3 class="suggestion-title">' + data.Title + "</h3>";
                suggestionItemHTML += '<p class="suggestion-year">' + data.Year + "</p>";
                suggestionItemHTML += '<p class="suggestion-plot">' + data.Plot + "</p>";
                $(".suggestion .ajax-content").html(suggestionItemHTML);
                $(".suggestion").slideDown(300).addClass("has-content");
            }
        });
    }
    searchField.on("keyup", function() {
        clearTimeout(typingTimer);
        typingTimer = setTimeout(doneTyping, doneTypingInterval);
    });
    searchField.on("keydown", function() {
        clearTimeout(typingTimer);
    });
    function doneTyping() {
        omdbAjaxCall();
    }
    $(".js-toggle-media-details").click(function(e) {
        e.preventDefault();
        $(this).closest(".media-item-detail").slideToggle(300);
    });
    $(".error-message-close").click(function() {
        $(this).parent().fadeOut();
    });
    if ($(".media-item").length > 1) {
        $("#check-all-delete").prop("disabled", false);
    }
    $('[name="media-type"]:checked').parent().addClass("is-checked");
    $('[name="media-type"]').change(function() {
        $(".media-type-wrap").removeClass("is-checked");
        $(this).parent().toggleClass("is-checked");
    });
    $("#check-all-delete").click(function() {
        if ($(this).is(":checked")) {
            $(".delete-item").prop("checked", true);
            $('label[for="check-all-delete"]').text("Uncheck all");
        } else {
            $(".delete-item").prop("checked", false);
            $('label[for="check-all-delete"]').text("Check all");
        }
    });
});